# ##### https://kali:8834/#/scans/folders/my-scans

#nessus-açmak

![[Pasted image 20240222115836.png]]

----

## Exploit 
##### Şimdi burada öğretmen de biz de aynı lab'ı kullanacağız. Metasploitable 3 win kullanılacak. 
### Target IP Finding
##### Hedefle aynı ağdağ olduğumuz için nat network ağımıza -sn ping scan attık
```
nmap 10.0.2.0/24 -sn
```
![[Pasted image 20240226110555.png]]

### Workspace ayarlandı ve global Rhost ayarlandı
![[Pasted image 20240226121840.png]]

### İlk enum msfconsole ile db_nmap ile yapıyoruz ve bu bizim workspace'simize kayıtolur.
```
db_nmap 10.0.2.5 -sS -sV -O -p-

```
![[Pasted image 20240226192630.png]]

### Bulduğumuz bir porttaki program versiyon hakkında exploit var mı search ile baktık.

## info komutu ile detayına baktık.

![[Pasted image 20240226192606.png]]
#### Warning
### option tuşuna baktıktan sonra bütün özelliklere bak. burada payload linux için düzenlenmiş bizim hedefimiz windows işletim sistemi buna göre payload'ı düzeltmek gerekir.
## windows/meterpreter/reverse_tcp
![[Pasted image 20240226192840.png]]
## Bu bizim bulduğumuz versiyona uyuyor gibi gözüküyor. 
### GlassFish 4.0

## Bu aşamada elimzdeki enum yeterli değil bu yüzden exploit gerçekleşemeyecek.
---

## searchsploit
### #searchsploit

### Kali linux terminalinde offline olarak exploit/vulnerability arama kütüphaesidir ve EXPLOITDB'de bulunan exploitleri gösterir tabiki Kali güncel ise.

![[Pasted image 20240226193939.png]]
## Örnneğin burada biz #port445 #port445-smb smb çalıştığını biliyoruz. 
### Bu veriyondaki zaafiyetleri direk #searchsploit de aratabiliriz.

![[Pasted image 20240226194119.png]]

### eternal blue ile meterpreter shell aldık
![[Pasted image 20240226195431.png]]
#eternalblue 

---

## Bizim msfconsole'da pluginler mevcut ve bunları da kullanabiliriz.

#### #msfconsole-plugin

### #db_autopwn Plugin

### Github
#### https://github.com/hahwul/metasploit-autopwn
##### Bunun kendi plugin'i var

![[Pasted image 20240226212201.png]]
### cd /usr/share/metasploit-framework/plugins

### wget https://raw.githubusercontent.com/hahwul/metasploit-autopwn/master/db_autopwn.rb

![[Pasted image 20240226212416.png]]

#### Plugin directory'e gidip github respitory'i yükledik.



## msf6>load db_autopwn
![[Pasted image 20240226212656.png]]
### msf6> db_autopwn
![[Pasted image 20240226212741.png]]
#### Deprecated yazmasının sebebi artık desteklenmiyor fakat hala kullanılıyor. 
### msfconcole'un bir parçası artık olmadığı için manuel olarak yüklenmesi gerekiyor.

## Sadece your scan'ler veya service'ler metasploit database de ise çalışışacaktır. Yani bunu kullanman için baştan itibaren database açık olacak ve workspace'de çalışıyor olmalısın.

### msf6 > db_autopwn -p -t

>[!warning] Bu şimdi ne var ne yoksa ortaya dökmeye çalışacak ve bir sürü analiz edemeyeceğimiz kadar veri çıkaracaktır. Bunu engellemek için port numarası üzerinden gitmelisin.

![[Pasted image 20240226213648.png]]

### msf6 > db_autopwn -PI 445 -p -t
![[Pasted image 20240226213847.png]]


---

## analyze
### #analyze-msfconsole

### Bu komut msfconsole database içindeki yapılmış ve kayıt olmuş enumları / hostları / service'leri analiz eder

## msf6> analyze
![[Pasted image 20240226214400.png]]


## msf6> vulns
![[Pasted image 20240226214502.png]]
![[Pasted image 20240226214518.png]]


---
![[Pasted image 20240226214739.png]]
## #nessus 

#### We can use the free version of Nessus (Nessus Essentials), which allows us to scan upto 16 IPs.

---
## Nessus'un kendi vuln database'i vardır.

![[Pasted image 20240226215318.png]]
![[Pasted image 20240226215337.png]]

---
![[Pasted image 20240226220201.png]]


### Eğer elinde herhangi bir credentials varsa ve bunu vuln scan de kullanmak istiyorsak ![[Pasted image 20240226220333.png]]
### Credentials Bölümünden yararlanarak yaparız.

---
## Herhangi bir plugin 'den de faydalanılacaksa 
![[Pasted image 20240226220452.png]]

---

![[Pasted image 20240226220809.png]]

## Filters - Nessus
#filter-nessus
![[Pasted image 20240226220902.png]]
##### Metasploit Exploit Framework - equal to - true
![[Pasted image 20240226220947.png]]

## Common Vulnerability  Scoring System
![[Pasted image 20240226221131.png]]

---
## Severity ---> High
![[Pasted image 20240226221402.png]]

![[Pasted image 20240226221455.png]]
![[Pasted image 20240226221510.png]]
![[Pasted image 20240226221524.png]]

---

## Nessus Scan'in Export Edilmesi
## Nessus Scan'in MSFCONSOLE Import Edilmesi

### nessus-export-to-msfconsole

![[Pasted image 20240226221713.png]]
![[Pasted image 20240226221757.png]]
### XML uzantılı olarak Nessus scan Download'a kaydedilir.

![[Pasted image 20240226222005.png]]
![[Pasted image 20240226222102.png]]


## Hemen yeni bir workspace tanımla çünkü elimizde bir yeni nessus scan var.

workspace -a MSF3Ubuntu
![[Pasted image 20240226222243.png]]

### Import Scan To MSFCONSOLE
![[Pasted image 20240226222348.png]]

![[Pasted image 20240226222538.png]]

```
msf6 > db_import /home/kali/Downloads/Mestasploitable-3\ Ubuntu_ypw7u6.nessus
```

## Vulns
![[Pasted image 20240226222655.png]]
## services / hosts
![[Pasted image 20240226222724.png]]

### msf6 > db_autopwn -p -t -PI 80
![[Pasted image 20240226222901.png]]

---

## vulns -p 445
![[Pasted image 20240226223319.png]]
### Vulns ' lar birbiri ardına sıralanacak bunu sadeceleştirme yolu port numarasından faydalanmak.

---
## Bizim için CVE numarası çok önemli bir exploit arıyorsak. msfconsole içine bu şekilde kaydedeiliyor çünkü.


![[Pasted image 20240226223633.png]]

---

## Microsoft Vulnerability Code
### ms12-020  buna göre de arama yapılabilir bu da msfconsole database de var
![[Pasted image 20240226224856.png]]



## vulns -S manage
![[Pasted image 20240226225906.png]]

---
## vulns da bizim dikkatimizi çeken başka bir zaafiyet
![[Pasted image 20240226225704.png]]

### msf6> search cve:2015 manageengine
![[Pasted image 20240226225403.png]]

![[Pasted image 20240226225312.png]]

## Direk bu zaafiyeti kullanaran NT Auth olduk.

https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-8249

https://www.rapid7.com/blog/post/2015/12/14/r7-2015-22-manageengine-desktop-central-9-fileuploadservlet-connectionid-vulnerability-cve-2015-8249/

https://www.exploit-db.com/exploits/38982

---

CVE-2015-8249, **ManageEngine Desktop Central 9** yazılımının **FileUploadServlet** sınıfında bulunan bir güvenlik açıklığıdır. Bu açıklıktan faydalanan bir saldırgan, **ConnectionId** parametresi aracılığıyla sunucuya **keyfi dosyalar yükleyebilir ve çalıştırabilir**.

**Etki Alanı:**

- İşletim Sistemi: Etkilenen işletim sistemi bilgisi mevcut değildir.
- Yazılım: ManageEngine Desktop Central 9 (build 91093'ten önceki sürümler)

**Oluşturan Uygulama:**

- ManageEngine Desktop Central 9

**Tedbirler:**

- **Yazılımı Güncelle:** ManageEngine Desktop Central 9'u build 91093 veya daha yeni bir sürüme güncelleyin.
- **Geçici Çözüm:** ManageEngine, geçici bir çözüm olarak **ConnectionId** parametresini devre dışı bırakma seçeneği sunmaktadır. Daha fazla bilgi için ManageEngine'in resmi belgelerine bakabilirsiniz.

**Ek Bilgiler:**

- **CVE Kimliği:** CVE-2015-8249
- **CVSSv3 Puanı:** 9.8 (Kritik)
- **Açıklanma Tarihi:** 14 Aralık 2015

---
### Temel olarak sistem şu şekilde çalışıyor. 
## Hedef numarasını Nessus'a verdik ve full scan yaptırdık.
### Sonra çıkan sonucu XML formatında Download's kaydettirdik ve bunu da db_import ile msfconsole aldık.

## Nessus içinden de tek tek critical zaafiyetlerden başlayarak bakıyoruz filter bölümğne de metasploit framework exploiti olanlara bakıyoruz ki hemen sonuç alalım.

### Sonra var olan zaafiyeti deniyoruz ve sisteme erişim sağladıktan sonra Enumeration ve Yetki yükseltme veya pivoting hareketlerimiz devam ediyor.
![[Pasted image 20240226230919.png]]
![[Pasted image 20240226230930.png]]

![[Pasted image 20240226232237.png]]

#### Bu modul direk hedef sistemi crash olmasına neden oluyor.

---

# Web App Vulnerability Scanning With WMAP

#wmap 

### + WMAP is a powerful, feature-rich web application vulnerability scanner that can be used to automate web server enumeration and scan web applications for vulnerabilities.

### <span style="background:#d4b106">WMAP is available as an MSF plugin and can be loaded directly into MSF.</span>

### WMAP is <span style="background:#fff88f">fully integrated with MSF,</span> which consequently allows us to perform web app vulnerability scanning from within the MSF.


## SQL injection dibi common vulnerabilty'leri database de bulundurur ve test eder.

### WMAP bizim için yapılabilecek bütün enum'ları otomatize eder ve zaman kazandırır. Eksileri artıları tabiki tartışılabilir.

## MSFCONSOLE-PLUGIN'ler de mevcut
#### <span style="background:#ff4d4f">Tek yapman gereken "load it and use it"</span>

## Ayrıca msfconsole database'e intagrate edilebilir böylece database üzerinden sonuçları görebiliriz.

---

# WMAP Using
![[Pasted image 20240226233211.png]]
### WMAP modulu msfconsole yüklememiz gerekiyor.

## load wmap

![[Pasted image 20240226233600.png]]

### wmap_ + TAB Tuşune basarsak bize modullerini sıralar
### #wmap_
![[Pasted image 20240226233719.png]]

## wmap_sites -h
![[Pasted image 20240226233809.png]]
### Önce hedef siteyi wmap'a ekliyoruz -a add komutuyla
## wmap_sites -a 10.0.2.6
![[Pasted image 20240226233953.png]]

## wmap_targets -h
![[Pasted image 20240226234108.png]]
### Burada hedef'lerin sitelerini tanımlıyoruz.
![[Pasted image 20240226234339.png]]

## wmap_sites -l
![[Pasted image 20240226234425.png]]
##### Önce siteleri ekliyoruz ve sonrasında targets'ları tanımlıyoruz.

---

## WMAP metasploit framework'ün auxiliary modullerini kullanarak vulnerability scan yapıyor. 

### Bunu gerçekleştirmesi için

## wmap run -t

### Bu komutu kullanıyor ki bu komut da bizim hedefle ilgili çeşitli auxiliary modulleri kontrol ediyor.

## wmap_run -h
![[Pasted image 20240226234921.png]]


## wmap_run -t
![[Pasted image 20240226235110.png]]


## wmap_run -e
- **wmap_run:** WMAP tarayıcısını çalıştırır.
<span style="background:#d4b106">- **-e:** Tüm testleri çalıştırır. Bu seçenek belirtilmezse, yalnızca varsayılan testler çalıştırılır.</span>

![[Pasted image 20240226235653.png]]
![[Pasted image 20240226235739.png]]
![[Pasted image 20240227000001.png]]


---
### Çıkan sonuçlarda aşağıdaki ekran görüntüsü gibi sonuç veriyor ancak aslında sistem zaafiyetli
![[Pasted image 20240227000404.png]]


---

## wmap_vulns -l
![[Pasted image 20240227000526.png]]

### wmap vulns komutu ile çok fazla birşey elde edemedik ama bizim için önemli olan bir husus #http-put auxiliary module sonucu

### Bizim web server'daki bir directory'e herhangi bir dosya yukleyebilirmiyiz bunu belirlememize yarıyor.

![[Pasted image 20240227000904.png]]

## use auxiliary(scanner/http/http_put)
![[Pasted image 20240227000940.png]]

### root directory içine dosya koyulmasına izin vermiyormuş bunu anladık.

![[Pasted image 20240227001213.png]]

---

![[Pasted image 20240227001342.png]]
### Ahanda biz sonunda file upload yapabileceğimiz bir klasör bulduk. Bu şu demek buraya örneğin bir php reverse shell alacak bir malicious dosya koy ve çalıştır. Shell al.....

## Veya biz web server içine reverse shell alınacak bir dosya yerleştirip listener'ı mızı açalım. O dosyaya birisi girdiğinde tıkladığında biz direk web server'dan shell alabiliriz.

---

## Curl ile dosta konulmuş mu bunu test edebiliriz
![[Pasted image 20240227001842.png]]
### curl http://10.0.2.6/data/msf_http_put_test.txt

---
## Karşıya atılan dosyanın içeriğini adını atılmadan değiştirebiliriz. 
![[Pasted image 20240227002024.png]]












### msf6 > db_nmap 10.0.2.6 -p- -sV -O























